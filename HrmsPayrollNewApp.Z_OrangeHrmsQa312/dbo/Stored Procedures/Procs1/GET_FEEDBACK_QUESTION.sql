


-- =============================================
-- AUTHOR:		<AUTHOR,,GADRIWALA MUSLIM>
-- CREATE DATE: <CREATE DATE,,01092016>
-- DESCRIPTION:	<DESCRIPTION,,GET FEEDBACK OF QUESTION>
---28/1/2021 (EDIT BY MEHUL ) (SP WITH NOLOCK)---
-- =============================================
-- exec [dbo].[GET_FEEDBACK_QUESTION] 266,120,0
CREATE PROCEDURE [dbo].[GET_FEEDBACK_QUESTION] 
@EXIT_ID NUMERIC(18,0),
@CMP_ID NUMERIC(18,0),
@Group_Id numeric(18,0)= 0  --Added by Jaina 15-06-2018
AS
BEGIN
SET NOCOUNT ON 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET ARITHABORT ON
	
	SELECT DISTINCT EF.QUESTION_ID,QEAM.QUESTION,DESCRIPTION,ANSWER_RATE,
	case when isnull(EAR.TITLE,'') <> '' then EAR.TITLE else isnull(EF.Comments,'') END as TITLE,
	case when EF.Answer_rate >0 then  isnull(EF.Comments,'') END as COMMENTS,
	--isnull(EF.Comments,'') as COMMENTS,
	
	EAR.RATING_ID,isnull(QEAM.Group_Id,0) as Group_Id,G.Group_Name
	FROM T0200_EXIT_FEEDBACK EF WITH (NOLOCK)
	INNER JOIN T0200_QUESTION_EXIT_ANALYSIS_MASTER QEAM WITH (NOLOCK) ON EF.QUESTION_ID = QEAM.QUEST_ID
	LEFT OUTER JOIN T0040_EXIT_ANALYSIS_RATING EAR WITH (NOLOCK) ON EAR.RATING_ID = EF.ANSWER_RATE and EF.Answer_rate > 0
	left OUTER JOIN T0040_Exit_Group_Master G WITH (NOLOCK) ON G.Group_Id = QEAM.Group_Id  --Added by Jaina 14-06-2018
	WHERE EF.EXIT_ID = @EXIT_ID AND EF.CMP_ID = @CMP_ID and QEAM.Group_Id = isnull(@Group_Id,QEAM.Group_Id)
	
    -- INSERT STATEMENTS FOR PROCEDURE HERE
	
END

