
--exec P_RPT_Change_Request_Approval @Cmp_ID=220,@From_Date='2021-10-01 00:00:00',@To_Date='2021-10-30 00:00:00',@Branch_ID='',@Cat_ID='',@Grd_ID='',@Type_ID='',@Dept_ID='',@Desig_ID='',@Emp_ID=0,@Constraint='26961# 26962# 26963# 26964# 26965# 26966# 26967# 26968# 26969# 26970# 26971# 26972# 26973# 26974# 26975# 26976# 26977# 26978# 26979# 26980# 26981# 26982# 26984# 26985# 26986# 26987# 26988# 26989# 26990# 26996# 26997# 26998# 26999# 27000# 27001# 27002# 27003# 27004# 27005# 27006# 27007# 27008# 27009# 27010# 27011# 27012# 27013# 27014# 27015# 27016# 27017# 27018# 27019# 27020# 27021# 27022# 27023# 27024# 27025# 27026# 27027# 27028# 27029# 27030# 27031# 27032# 27033# 27034# 27035# 27036# 27037# 27038# 27039# 27040# 27041# 27042# 27043# 27044# 27045# 27046# 27047# 27048# 27049# 27050# 27051# 27052# 27053# 27054# 27055# 27056# 27057# 27058# 27059# 27060# 27061# 27062# 27063# 27064# 27065# 27066# 27067# 27068# 27069# 27070# 27071# 27072# 27073# 27074# 27075# 27076# 27077# 27078# 27079# 27080# 27081# 27082# 27083# 27084# 27085# 27086# 27087# 27088# 27089# 27090# 27091# 27092# 27093# 27094# 27095# 27096# 27097# 27098# 27099# 27100# 27101# 27102# 27103# 27104# 27105# 27106# 27107# 27108# 27109# 27110',@Vertical_ID='',@SubVertical_Id='',@SubBranch_Id='',@Request_Type='PAN CARD & AADHAAR CARD'

--exec P_RPT_Change_Request_Approval @Cmp_ID=220,@From_Date='2021-10-01 00:00:00',@To_Date='2021-10-30 00:00:00',@Branch_ID='',@Cat_ID='',@Grd_ID='',@Type_ID='',@Dept_ID='',@Desig_ID='',@Emp_ID=0,@Constraint='26961# 26962# 26963# 26964# 26965# 26966# 26967# 26968# 26969# 26970# 26971# 26972# 26973# 26974# 26975# 26976# 26977# 26978# 26979# 26980# 26981# 26982# 26984# 26985# 26986# 26987# 26988# 26989# 26990# 26996# 26997# 26998# 26999# 27000# 27001# 27002# 27003# 27004# 27005# 27006# 27007# 27008# 27009# 27010# 27011# 27012# 27013# 27014# 27015# 27016# 27017# 27018# 27019# 27020# 27021# 27022# 27023# 27024# 27025# 27026# 27027# 27028# 27029# 27030# 27031# 27032# 27033# 27034# 27035# 27036# 27037# 27038# 27039# 27040# 27041# 27042# 27043# 27044# 27045# 27046# 27047# 27048# 27049# 27050# 27051# 27052# 27053# 27054# 27055# 27056# 27057# 27058# 27059# 27060# 27061# 27062# 27063# 27064# 27065# 27066# 27067# 27068# 27069# 27070# 27071# 27072# 27073# 27074# 27075# 27076# 27077# 27078# 27079# 27080# 27081# 27082# 27083# 27084# 27085# 27086# 27087# 27088# 27089# 27090# 27091# 27092# 27093# 27094# 27095# 27096# 27097# 27098# 27099# 27100# 27101# 27102# 27103# 27104# 27105# 27106# 27107# 27108# 27109# 27110',@Vertical_ID='',@SubVertical_Id='',@SubBranch_Id='',@Request_Type='SIM CARD'
--	exec P_RPT_Change_Request_Approval @Cmp_ID=220,@From_Date='2021-10-01 00:00:00',@To_Date='2021-10-31 00:00:00',@Branch_ID='',@Cat_ID='',@Grd_ID='',@Type_ID='',@Dept_ID='',@Desig_ID='',@Emp_ID=0,@Constraint='26961# 26962# 26963# 26964# 26965# 26966# 26967# 26968# 26969# 26970# 26971# 26972# 26973# 26974# 26975# 26976# 26977# 26978# 26979# 26980# 26981# 26982# 26984# 26985# 26986# 26987# 26988# 26989# 26990# 26996# 26997# 26998# 26999# 27000# 27001# 27002# 27003# 27004# 27005# 27006# 27007# 27008# 27009# 27010# 27011# 27012# 27013# 27014# 27015# 27016# 27017# 27018# 27019# 27020# 27021# 27022# 27023# 27024# 27025# 27026# 27027# 27028# 27029# 27030# 27031# 27032# 27033# 27034# 27035# 27036# 27037# 27038# 27039# 27040# 27041# 27042# 27043# 27044# 27045# 27046# 27047# 27048# 27049# 27050# 27051# 27052# 27053# 27054# 27055# 27056# 27057# 27058# 27059# 27060# 27061# 27062# 27063# 27064# 27065# 27066# 27067# 27068# 27069# 27070# 27071# 27072# 27073# 27074# 27075# 27076# 27077# 27078# 27079# 27080# 27081# 27082# 27083# 27084# 27085# 27086# 27087# 27088# 27089# 27090# 27091# 27092# 27093# 27094# 27095# 27096# 27097# 27098# 27099# 27100# 27101# 27102# 27103# 27104# 27105# 27106# 27107# 27108# 27109# 27110',@Vertical_ID='',@SubVertical_Id='',@SubBranch_Id='',@Request_Type='Skip Monthly Loan Installment'


--exec P_RPT_Change_Request_Approval @Cmp_ID=220,@From_Date='2021-10-01 00:00:00',@To_Date='2021-10-31 00:00:00',@Branch_ID='',@Cat_ID='',@Grd_ID='',@Type_ID='',@Dept_ID='',@Desig_ID='',@Emp_ID=0,@Constraint='26961# 26962# 26963# 26964# 26965# 26966# 26967# 26968# 26969# 26970# 26971# 26972# 26973# 26974# 26975# 26976# 26977# 26978# 26979# 26980# 26981# 26982# 26984# 26985# 26986# 26987# 26988# 26989# 26990# 26996# 26997# 26998# 26999# 27000# 27001# 27002# 27003# 27004# 27005# 27006# 27007# 27008# 27009# 27010# 27011# 27012# 27013# 27014# 27015# 27016# 27017# 27018# 27019# 27020# 27021# 27022# 27023# 27024# 27025# 27026# 27027# 27028# 27029# 27030# 27031# 27032# 27033# 27034# 27035# 27036# 27037# 27038# 27039# 27040# 27041# 27042# 27043# 27044# 27045# 27046# 27047# 27048# 27049# 27050# 27051# 27052# 27053# 27054# 27055# 27056# 27057# 27058# 27059# 27060# 27061# 27062# 27063# 27064# 27065# 27066# 27067# 27068# 27069# 27070# 27071# 27072# 27073# 27074# 27075# 27076# 27077# 27078# 27079# 27080# 27081# 27082# 27083# 27084# 27085# 27086# 27087# 27088# 27089# 27090# 27091# 27092# 27093# 27094# 27095# 27096# 27097# 27098# 27099# 27100# 27101# 27102# 27103# 27104# 27105# 27106# 27107# 27108# 27109# 27110',@Vertical_ID='',@SubVertical_Id='',@SubBranch_Id='',@Request_Type='PAN CARD & AADHAAR CARD'Pan Card & Aadhaar Card
                                                                                                                                                                                                                                                                                                    
  
  --exec P_RPT_Change_Request_Approval @Cmp_ID=220,@From_Date='2021-10-01 00:00:00',@To_Date='2021-10-31 00:00:00',
  --@Branch_ID='',@Cat_ID='',@Grd_ID='',@Type_ID='',@Dept_ID='',@Desig_ID='',@Emp_ID=0,
  --@Constraint='26961# 26962# 26963# 26964# 26965# 26966# 26967# 26968# 26969# 26970# 26971# 26972# 26973# 26974# 26975# 26976# 26977# 26978# 26979# 26980# 26981# 26982# 26984# 26985# 26986# 26987# 26988# 26989# 26990# 26991# 26992# 26993# 26994# 26995# 26996# 26997# 26998# 26999# 27000# 27001# 27002# 27003# 27004# 27005# 27006# 27007# 27008# 27009# 27010# 27011# 27012# 27013# 27014# 27015# 27016# 27017# 27018# 27019# 27020# 27021# 27022# 27023# 27024# 27025# 27026# 27027# 27028# 27029# 27030# 27031# 27032# 27033# 27034# 27035# 27036# 27037# 27038# 27039# 27040# 27041# 27042# 27043# 27044# 27045# 27046# 27047# 27048# 27049# 27050# 27051# 27052# 27053# 27054# 27055# 27056# 27057# 27058# 27059# 27060# 27061# 27062# 27063# 27064# 27065# 27066# 27067# 27068# 27069# 27070# 27071# 27072# 27073# 27074# 27075# 27076# 27077# 27078# 27079# 27080# 27081# 27082# 27083# 27084# 27085# 27086# 27087# 27088# 27089# 27090# 27091# 27092# 27093# 27094# 27095# 27096# 27097# 27098# 27099# 27100# 27101# 27102# 27103# 27104# 27105# 27106# 27107# 27108# 27109# 27110',
  --@Vertical_ID='',@SubVertical_Id='',@SubBranch_Id='',@Request_Type='Pan Card & Aadhaar Card'	

CREATE PROCEDURE [dbo].[P_RPT_Change_Request_Approval]  
  @CMP_ID   NUMERIC  
 ,@FROM_DATE  DATETIME  
 ,@TO_DATE   DATETIME  
 ,@BRANCH_ID  VARCHAR(MAX)=''  
 ,@CAT_ID  VARCHAR(MAX)=''  
 ,@GRD_ID  VARCHAR(MAX)=''  
 ,@TYPE_ID  VARCHAR(MAX)=''  
 ,@DEPT_ID  VARCHAR(MAX)=''  
 ,@DESIG_ID  VARCHAR(MAX)=''  
 ,@EMP_ID  NUMERIC  = 0  
 ,@CONSTRAINT VARCHAR(MAX) = ''  
 ,@VERTICAL_ID   VARCHAR(MAX)  = ''    
 ,@SUBVERTICAL_ID  VARCHAR(MAX) = ''   
 ,@SUBBRANCH_ID VARCHAR(MAX) = ''    
 ,@REQUEST_TYPE  VARCHAR(50) = ''  
AS  
 SET NOCOUNT ON   
 SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED  
 SET ARITHABORT ON  
 SET ANSI_WARNINGS OFF;  
  
 CREATE TABLE #EMP_CONS   
 (        
  EMP_ID NUMERIC ,       
  BRANCH_ID NUMERIC,  
  INCREMENT_ID NUMERIC  
 )  
    
 EXEC SP_RPT_FILL_EMP_CONS_MULTIDROPDOWN @CMP_ID = @CMP_ID,@FROM_DATE = @FROM_DATE,@TO_DATE = @TO_DATE,@BRANCH_ID = @BRANCH_ID,@CAT_ID = @CAT_ID,  
   @GRD_ID = @GRD_ID,@TYPE_ID = @TYPE_ID,@DEPT_ID = @DEPT_ID,@DESIG_ID = @DESIG_ID,@EMP_ID = @EMP_ID,@CONSTRAINT = @CONSTRAINT,  
   @SAL_TYPE = 0,@SALARY_CYCLE_ID = 0,@SEGMENT_ID = '',@VERTICAL_ID = @VERTICAL_ID,@SUBVERTICAL_ID = @SUBVERTICAL_ID,  
   @SUBBRANCH_ID = @SUBBRANCH_ID,@NEW_JOIN_EMP = 0,@LEFT_EMP = 0,@SALSCYLE_FLAG = 0,@PBRANCH_ID = '0',@WITH_CTC = 0,@TYPE = 0   
   
   
   
  DECLARE @OLD_COL AS VARCHAR(MAX)  
  DECLARE @NEW_COL AS VARCHAR(MAX)    
  DECLARE @SQL AS VARCHAR(MAX)  
  DECLARE @FROMDATE as varchar(20)  
  DECLARE @TODATE as varchar(20)  
  DECLARE @FLag as TINYINT  
    
  set @FLag =0  
    
  Set @FROMDATE = convert(VARCHAR(10),@FROM_DATE,120)  
  Set @TODATE = convert(VARCHAR(10),@TO_DATE,120)  
  print @REQUEST_TYPE  --mansi

  IF @REQUEST_TYPE = 'BIRTHDATE CHANGE'  
   BEGIN   
   
    set @FLag = 1  
    SET @OLD_COL = '''DATE : ''+  LEFT(V.CURR_DETAILS,10)'   
    SET @NEW_COL = '''DATE : '' +  LEFT(V.NEW_DETAILS,10)'  
   END  
  ELSE IF @REQUEST_TYPE = 'BRANCH CHANGE'   
   BEGIN   
            
    SET @SQL = 'SELECT ''BRANCH : ''+  BM.BRANCH_NAME AS OLD_VALUE,''BRANCH : ''+  BM1.BRANCH_NAME AS NEW_VALUE        
       ,CRA.EMP_Id,Em.emp_Full_Name,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
       ,CRA.Request_Date,CRA.Request_type,CRA.Change_Reason,CRA.Effective_Date  
       ,cm.cmp_Name,cm.cmp_address,cra.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
       ,CRA.Application_Request_Date,em.Emp_first_Name,BM.branch_Name  
       FROM V0090_Change_Request_Approval_Admin_Report CRA LEFT JOIN   
         T0030_BRANCH_MASTER BM WITH (NOLOCK) ON CRA.CURR_DETAILS = CAST(BM.BRANCH_ID AS VARCHAR(500)) AND CRA.CMP_ID = BM.CMP_ID LEFT JOIN  
         T0030_BRANCH_MASTER BM1 WITH (NOLOCK) ON CAST(BM1.BRANCH_ID AS VARCHAR(500)) = CRA.NEW_DETAILS AND CRA.CMP_ID = BM1.CMP_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = CRA.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join  
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)   
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id           
       WHERE   CRA.REQUEST_TYPE = ''' + @REQUEST_TYPE + '''   
         and (convert(VARCHAR(10),CRA.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),CRA.request_date,120) <= ''' + @TODATE + ''')'               
          
                
    EXEC (@SQL)   
      
   END  
  ELSE IF @REQUEST_TYPE = 'SHIFT CHANGE'   
   BEGIN   
         
    SET @SQL = 'SELECT  (''SHIFT NAME : '' + SM.SHIFT_NAME  + CHAR(13) + ''FROM DATE : '' + CONVERT(VARCHAR(20),V.SHIFT_FROM_DATE,103) +  CHAR(13) + ''TO DATE : '' + CONVERT(VARCHAR(20),V.SHIFT_TO_DATE,103)) AS OLD_VALUE,  
         (''SHIFT NAME : '' + SM1.SHIFT_NAME  + CHAR(13) + ''FROM DATE : '' + CONVERT(VARCHAR(20),V.SHIFT_FROM_DATE,103) +  CHAR(13) + ''TO DATE : '' + CONVERT(VARCHAR(20),V.SHIFT_TO_DATE,103)) AS NEW_VALUE  
         ,V.EMP_Id,Em.emp_Full_Name,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
         ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
         ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM V0090_Change_Request_Approval_Admin_Report V LEFT JOIN  
         T0040_SHIFT_MASTER SM WITH (NOLOCK) ON V.CURR_DETAILS = CAST(SM.SHIFT_ID AS VARCHAR(10)) AND V.CMP_ID = SM.CMP_ID LEFT JOIN  
         T0040_SHIFT_MASTER SM1 WITH (NOLOCK) ON V.NEW_DETAILS = CAST(SM1.SHIFT_ID AS VARCHAR(10)) AND V.CMP_ID = SM1.CMP_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join  
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)   
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE V.REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
    EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'MARITAL STATUS CHANGE'   
   BEGIN   
         
    set @FLag = 1     
      
             
    SET @OLD_COL = '''MARITAL STATUS : ''+  (CASE WHEN V.CURR_DETAILS = ''0'' THEN ''SINGLE''   
             WHEN V.CURR_DETAILS = ''1'' THEN ''MARRIED''   
              WHEN V.CURR_DETAILS = ''2'' THEN ''DIVORCED''  
             ELSE ''SAPERATED'' END)'   
    SET @NEW_COL = '''MARITAL STATUS : ''+  (CASE WHEN V.NEW_DETAILS = ''0'' THEN ''SINGLE''   
             WHEN V.NEW_DETAILS = ''1'' THEN ''MARRIED''   
              WHEN V.NEW_DETAILS = ''2'' THEN ''DIVORCED''  
             ELSE ''SAPERATED'' END)'  
      
      
   END  
  ELSE IF @REQUEST_TYPE = 'PERMANENT ADDRESS CHANGE' OR @REQUEST_TYPE = 'PRESENT ADDRESS CHANGE'  
   BEGIN   
         
    SET @SQL = 'SELECT  (''ADDRESS : '' + IsNull(V.CURR_DETAILS,'''') + CHAR(13) + ''TEHSIL : '' + IsNull(V.CURR_TEHSIL,'''') + CHAR(13) +   
         ''DISTRICT : '' + IsNull(V.CURR_DISTRICT,'''') + CHAR(13) + ''POLICE STATION : '' + IsNull(V.CURR_TEHSIL,'''') + CHAR(13) +   
         ''THANA : '' + IsNull(TM.THANANAME,'''') + CHAR(13) + ''CITY : '' + IsNull(V.CURR_CITY_VILLAGE,'''') + CHAR(13) +  
         ''STATE : '' + IsNull(V.CURR_STATE,'''') + CHAR(13) + ''PINCODE : '' + CAST(IsNull(V.CURR_PINCODE,0) AS VARCHAR(10))) AS OLD_VALUE,  
         (''ADDRESS : '' + IsNull(V.NEW_DETAILS,'''') + CHAR(13) + ''TEHSIL : '' + IsNull(V.NEW_TEHSIL,'''') + CHAR(13) +   
         ''DISTRICT : '' + IsNull(V.NEW_DISTRICT,'''') + CHAR(13) + ''POLICE STATION : '' + IsNull(V.NEW_TEHSIL,'''') + CHAR(13) +   
         ''THANA : '' + IsNull(TM1.THANANAME,'''') + CHAR(13) + ''CITY : '' + IsNull(V.NEW_CITY_VILLAGE,'''') + CHAR(13) +  
         ''STATE : '' + IsNull(V.NEW_STATE,'''') + CHAR(13) + ''PINCODE : '' + CAST(IsNull(V.NEW_PINCODE,0) AS VARCHAR(10))) AS NEW_VALUE,V.EMP_Id,Em.emp_Full_Name  
         ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
         ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
         ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM V0090_Change_Request_Approval_Admin_Report V LEFT JOIN  
         T0030_THANA_MASTER TM WITH (NOLOCK) ON TM.THANA_ID  = V.CURR_THANA AND TM.CMP_ID = V.CMP_ID LEFT JOIN  
         T0030_THANA_MASTER TM1 WITH (NOLOCK) ON TM1.THANA_ID  = V.NEW_THANA AND TM1.CMP_ID = V.CMP_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join  
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   V.REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'QUALIFICATION'  
   BEGIN   
         
    SET @SQL = 'SELECT '''' AS OLD_VALUE,(''QUALIFICATION : ''  + QM.QUAL_NAME + CHAR(13) + ''SPECIALIZATION : '' + V.SPECIALIZATION + CHAR(13) +  
           ''PASSING YEAR : '' + CAST(V.PASSING_YEAR AS VARCHAR(5)) + CHAR(13) +   
           ''SCORE : '' + CAST(V.SCORE AS VARCHAR(5)) + CHAR(13) + ''QUAL. START DATE : '' + CONVERT(VARCHAR(10),V.QUAULIFICATION_STAR_DATE,103) + CHAR(13) +  
           ''QUAL.END DATE : '' + CONVERT(VARCHAR(10),V.QUAULIFICATION_END_DATE,103)) as NEW_VALUE,V.EMP_Id,Em.emp_Full_Name  
         ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
         ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
         ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM V0090_Change_Request_Approval_Admin_Report V LEFT JOIN  
         T0040_QUALIFICATION_MASTER QM WITH (NOLOCK) ON QM.QUAL_ID = V.QUAULIFICATION_ID AND QM.CMP_ID = V.CMP_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id  inner join  
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id           
       WHERE   V.REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'DEPENDENT'  
   BEGIN   
         
    SET @SQL = 'SELECT '''' as OLD_VALUE,(''DEPDT NAME : ''  + V.DEPENDANT_NAME + CHAR(13) + ''DEPDT GENDER : '' + V.DEPENDANT_GENDER + CHAR(13) +  
           ''DEPDT DOB : '' + CONVERT(VARCHAR(10),V.PASSING_YEAR,103) + CHAR(13) +   
           ''DEPDT AGE : '' + CAST(V.DEPENDANT_AGE AS VARCHAR(5)) + CHAR(13) + ''DEPDT RELATIONSHIP: '' + V.DEPENDANT_RELATIONSHIP + CHAR(13) +  
           ''DEPDT IS_RESIDENT : '' + (CASE WHEN V.DEPENDANT_IS_RESIDENT = 1 THEN ''YES'' ELSE ''NO'' END ) + CHAR(13) +   
           ''DEPDT IS_DEPENDENT : '' + + (CASE WHEN V.DEPENDANT_IS_DEPENDANT = 1 THEN ''YES'' ELSE ''NO'' END )) NEW_VALUE  
           ,V.EMP_Id,Em.emp_Full_Name  
           ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
           ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM V0090_Change_Request_Approval_Admin_Report V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'PASSPORT' OR @REQUEST_TYPE = 'VISA'  
   BEGIN   
         
    SET @SQL = 'SELECT '''' as OLD_VALUE,('''+ @REQUEST_TYPE + ' CITIZENSHIP : ''  + LM.LOC_NAME + CHAR(13) + '''+ @REQUEST_TYPE + ' NO : '' + V.PASS_VISA_NO + CHAR(13) +  
           '''+ @REQUEST_TYPE + ' ISSUEDATE : '' + CONVERT(VARCHAR(10),V.PASS_VISA_ISSUE_DATE,103) + CHAR(13) +   
           '''+ @REQUEST_TYPE + ' EXPDATE : '' + CONVERT(VARCHAR(10),V.PASS_VISA_EXP_DATE,103) + CHAR(13) + '''+ @REQUEST_TYPE + ' REVIEWDATE : '' + CONVERT(VARCHAR(10),V.PASS_VISA_REVIEW_DATE,103) + CHAR(13) +  
           '''+ @REQUEST_TYPE + ' STATUS : '' + V.PASS_VISA_STATUS) AS NEW_VALUE  
           ,V.EMP_Id,Em.emp_Full_Name  
           ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
           ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM    V0090_Change_Request_Approval_Admin_Report V LEFT JOIN   
         T0001_LOCATION_MASTER LM WITH (NOLOCK) ON LM.LOC_ID = V.PASS_VISA_CITIZENSHIP INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'LICENSE'  
   BEGIN   
         
    SET @SQL = 'SELECT '''' as Old_VALUE,(''LICENSE : ''  + LM.LIC_NAME + CHAR(13) + ''LICENSE TYPE : '' + V.LICENSE_TYPE + CHAR(13) +  
           ''LICENSE ISSUEDATE : '' + CONVERT(VARCHAR(10),V.LICENSE_ISSUEDATE,103) + CHAR(13) +   
           ''LICENSE NO : '' + V.LICENSE_NO + CHAR(13) + ''LICENSE EXPDATE : '' + CONVERT(VARCHAR(10),V.LICENSE_EXPDATE,103) + CHAR(13) +  
           ''LICENSE IS_EXP : '' + (CASE WHEN V.LICENSE_IS_EXPIRED = 1 THEN ''YES'' ELSE ''NO'' END)) AS New_VALUE  
           ,V.EMP_Id,Em.emp_Full_Name  
           ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
           ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM    V0090_Change_Request_Approval_Admin_Report V LEFT JOIN   
         T0040_LICENSE_MASTER LM WITH (NOLOCK) ON LM.LIC_ID = V.LICENSE_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)   
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK)  ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
   ELSE IF @REQUEST_TYPE = 'OTHERS'  
   BEGIN   
         
    SET @SQL = 'SELECT '''' as Old_VALUE,'''' AS New_VALUE  
           ,V.EMP_Id,Em.emp_Full_Name  
           ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
           ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM    V0090_Change_Request_Approval_Admin_Report V LEFT JOIN   
         T0040_LICENSE_MASTER LM WITH (NOLOCK) ON LM.LIC_ID = V.LICENSE_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'BANK DETAILS'  
   BEGIN   
         
    SET @SQL =  'SELECT (''BANK : ''  + BM.BANK_NAME +  CHAR(13) + ''BANK IFSC CODE : '' + CAST(V.CURR_IFSC_CODE AS VARCHAR(20)) + CHAR(13) +  
         ''BANK ACCOUNT NO : '' + CAST(V.CURR_ACCOUNT_NO AS VARCHAR(20))+ CHAR(13) +   
         ''BANK BRNACH : '' + V.CURR_BRANCH_NAME) AS OLD_VALUE  
          ,(''BANK : ''  + BM1.BANK_NAME +  CHAR(13) + ''BANK IFSC CODE : '' + CAST(V.NEW_IFSC_CODE AS VARCHAR(20)) + CHAR(13) +  
         ''BANK ACCOUNT NO : '' + CAST(V.NEW_ACCOUNT_NO AS VARCHAR(20))+ CHAR(13) +   
         ''BANK BRNACH : '' + V.NEW_BRANCH_NAME) AS NEW_VALUE,  
          V.EMP_Id,Em.emp_Full_Name  
          ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
         ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
         ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM    V0090_Change_Request_Approval_Admin_Report V LEFT JOIN  
         T0040_BANK_MASTER BM WITH (NOLOCK) ON CAST(BM.BANK_ID AS VARCHAR(10)) = V.CURR_DETAILS AND BM.CMP_ID = V.CMP_ID LEFT JOIN   
         T0040_BANK_MASTER BM1 WITH (NOLOCK) ON CAST(BM1.BANK_ID AS VARCHAR(10)) = V.NEW_DETAILS AND BM.CMP_ID = V.CMP_ID INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'NOMINEES'  
   BEGIN   
         
    SET @SQL =  'SELECT '''' AS OLD_VALUE,(''NAME  : ''  + V.DEPENDANT_NAME +  CHAR(13) + ''RELATIONSHIP : '' + V.DEPENDANT_RELATIONSHIP + CHAR(13) +  
         ''IS_RESIDENT : '' + (CASE WHEN V.DEPENDANT_IS_RESIDENT = 1 THEN ''YES'' ELSE ''NO'' END) + CHAR(13) +  
         ''ADDRESS : '' + V.NOMINESS_ADDRESS + CHAR(13) +  ''NOMINEE SHARE : '' + CAST(V.NOMINESS_SHARE AS VARCHAR(5)) +  CHAR(13) +  
         ''NOMINEE FOR : '' + (CASE WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''0'' THEN ''ALL''  
                WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''1'' THEN ''PF''  
                WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''2'' THEN ''GRATUITY''  
                WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''3'' THEN ''ESIC''  
                WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''4'' THEN ''GPA''  
                WHEN CAST(V.NOMINESS_FOR AS VARCHAR(2)) = ''5'' THEN ''SUPER ANNUATION'' END) + CHAR(13) +  
         ''DOB : '' + CONVERT(VARCHAR(15),V.DEPENDANT_DOB,103)) AS NEW_VALUE,V.EMP_Id,Em.emp_Full_Name  
         ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
           ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
       FROM    V0090_Change_Request_Approval_Admin_Report V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
       WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
     EXEC (@SQL)  
      
   END   
  ELSE IF @REQUEST_TYPE = 'MEDICLAIM'  
   BEGIN   
         
    SET @SQL =  'SELECT '''' AS OLD_VALUE,(''PATIENT NAME : ''  + V.NOMINEES_ROW_ID +  CHAR(13) + ''HOSPITAL NAME : '' + V.HOSPITAL_NAME + CHAR(13) +  
         ''HOSPITAL ADDRESS : '' + V.HOSPITAL_ADDRESS + CHAR(13) +  
         ''ADDRESS : '' + V.NOMINESS_ADDRESS + CHAR(13) +  
         ''CLAIM APPROVAL AMOUNT : '' + CAST(V.MEDICALIM_APPROVAL_AMOUNT AS VARCHAR(10)) + CHAR(13) +  
         ''ADMIT DATE : '' + CONVERT(VARCHAR(15),V.ADMIT_DATE,103)) AS NEW_VALUE,V.EMP_Id,Em.emp_Full_Name  
         ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
        FROM    V0090_Change_Request_Approval_Admin_Report V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
        WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
           
     EXEC (@SQL)  
      
   END    
  ---ELSE IF @REQUEST_TYPE = 'PAN CARD & ADHAR CARD'
   ELSE IF @REQUEST_TYPE = 'PAN CARD & AADHAAR CARD'
 
   BEGIN   
   
   
    SET @SQL =  'SELECT (''PAN CARD NO : ''  + IsNUll(V.OLD_PAN_NO,'''') +  CHAR(13) + ''ADHAR CARD NO : '' + IsNUll(V.OLD_ADHAR_NO,'''')) AS OLD_VALUE,  
         (''PAN CARD NO : '' + IsNUll(V.NEW_PAN_NO,'''') + CHAR(13) + ''ADHAR CARD NO : '' + IsNUll(V.NEW_ADHAR_NO,'''')) AS NEW_VALUE  
         ,V.EMP_Id,Em.emp_Full_Name,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
           ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
           ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
         ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
        FROM    V0090_Change_Request_Approval_Admin_Report V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK)  ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
        WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
    print @sql
     EXEC (@SQL)  
      
   END  
  ELSE IF @REQUEST_TYPE = 'SKIP MONTHLY LOAN INSTALLMENT'  
   BEGIN   
         
    SET @SQL =  'SELECT  '''' AS OLD_VALUE,(''LOAN SKIP MONTH : ''  + CAST(V.LOAN_MONTH AS VARCHAR(5)) +  CHAR(13) + ''LOAN SKIP YEAR : '' + CAST(V.LOAN_YEAR AS VARCHAR(5))) AS NEW_VALUE  
          ,V.EMP_Id,Em.emp_Full_Name  
          ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
          ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
          ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
          ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
        FROM    V0090_Change_Request_Approval_Admin_Report  V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)   
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK)  ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
        WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
         
     PRINT @SQL  
     EXEC (@SQL)  
      
   END  

     ELSE IF @REQUEST_TYPE = 'SIM CARD' 
	 BEGIN
		  SET @SQL =  'SELECT  '''' AS OLD_VALUE,(''SIM CARD : '') AS NEW_VALUE  
			  ,V.EMP_Id,Em.emp_Full_Name  
			  ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
			  ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
			  ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
			  ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
			FROM    V0090_Change_Request_Approval_Admin_Report  V INNER JOIN  
			 #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
			 t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
			 (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
			  FROM t0095_increment TI WITH (NOLOCK)   
				INNER JOIN (  
				   SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
				   FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
				   WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
				   GROUP BY T0095_Increment.emp_ID  
				   ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
			  WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
			 T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
			 T0040_DEpartment_MASTER De WITH (NOLOCK)  ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
			 T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
			 T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
			 T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
			 t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
			WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
			 and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
			 and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
      
     PRINT @SQL  
     EXEC (@SQL)
	 END
      ELSE IF @REQUEST_TYPE = 'CHILD BIRTH DETAIL' 
	                              -- Child Birth Detail
	BEGIN
		  SET @SQL =  'SELECT  '''' AS OLD_VALUE,(''SIM CARD : '') AS NEW_VALUE  
			  ,V.EMP_Id,Em.emp_Full_Name  
			  ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
			  ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
			  ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
			  ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
			FROM    V0090_Change_Request_Approval_Admin_Report  V INNER JOIN  
			 #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
			 t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
			 (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
			  FROM t0095_increment TI WITH (NOLOCK)   
				INNER JOIN (  
				   SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
				   FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
				   WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
				   GROUP BY T0095_Increment.emp_ID  
				   ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
			  WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
			 T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
			 T0040_DEpartment_MASTER De WITH (NOLOCK)  ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
			 T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
			 T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
			 T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
			 t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
			WHERE  REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
			 and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
			 and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
      
      
     PRINT @SQL  
     EXEC (@SQL)
	END
    If @FLag = 1   
     BEGIN  
      SET @SQL = 'SELECT (' + @OLD_COL + ') AS OLD_VALUE,(' + @NEW_COL +') AS NEW_VALUE   
     ,V.EMP_Id,Em.emp_Full_Name  
     ,D.Desig_Name,de.Dept_Name,T.Type_name,G.grd_Name,Em.ALpha_Emp_Code  
     ,V.Request_Date,V.Request_type,V.Change_Reason,V.Effective_Date  
     ,cm.cmp_Name,cm.cmp_address,V.Request_status,''' + @FROMDATE + ''' as From_Date,''' + @TODATE + ''' as To_Date  
     ,V.Application_Request_Date,em.Emp_first_Name,B.branch_Name  
     FROM V0090_Change_Request_Approval_Admin_Report V INNER JOIN  
         #EMP_CONS EC ON EC.EMP_ID = V.EMP_ID inner join  
         t0080_EmP_Master Em WITH (NOLOCK) On Em.emp_Id = EC.EMp_Id inner join           
         (SELECT TI.Type_Id,TI.Grd_Id,TI.Desig_Id,TI.Dept_Id,TI.Increment_ID,TI.Branch_ID,TI.Emp_ID, TI.INCREMENT_EFFECTIVE_dATE  
          FROM t0095_increment TI WITH (NOLOCK)  
            INNER JOIN (  
               SELECT MAX(T0095_Increment.Increment_ID) AS Increment_ID,T0095_Increment.Emp_ID   
               FROM T0095_Increment WITH (NOLOCK) INNER JOIN T0080_EMP_MASTER E WITH (NOLOCK) ON T0095_INCREMENT.Emp_ID=E.Emp_ID   
               WHERE convert(VARCHAR(10),T0095_Increment.Increment_effective_Date,120) <= '''+ @TODATE +''' AND T0095_Increment.Cmp_ID = '+ cast(@cmp_Id as varchar(5)) +'    
               GROUP BY T0095_Increment.emp_ID  
               ) new_inc ON TI.Emp_ID = new_inc.Emp_ID AND Ti.Increment_ID=new_inc.Increment_ID  
          WHERE convert(VARCHAR(10),Increment_effective_Date,120) <= '''+  @TODATE +'''  )  ES on EC.Emp_ID = ES.Emp_ID LEFT JOIN  
         T0040_DESIGNATION_MASTER D WITH (NOLOCK) ON D.DESIG_ID = ES.DESIG_ID LEFT JOIN  
         T0040_DEpartment_MASTER De WITH (NOLOCK) ON De.DEpt_ID = ES.DEpt_ID LEFT JOIN  
         T0030_Branch_MASTER B WITH (NOLOCK) ON B.Branch_Id = ES.Branch_Id LEFT JOIN  
         T0040_TYPE_MASTER T WITH (NOLOCK) ON T.Type_Id = ES.Type_Id LEFT JOIN  
         T0040_GRADE_MASTER G WITH (NOLOCK) ON G.grd_Id = ES.grd_Id inner join  
         t0010_company_Master Cm WITH (NOLOCK) On cm.cmp_Id = Em.cmp_Id  
     WHERE   REQUEST_TYPE = ''' + @REQUEST_TYPE + '''  
         and (convert(VARCHAR(10),V.request_date,120) >= ''' + @FROMDATE + '''   
         and convert(VARCHAR(10),V.request_date,120) <= ''' + @TODATE + ''')'  
           
        print @sql    
      EXEC (@SQL)  
     END  
    
    
     
RETURN   
   
    
  
