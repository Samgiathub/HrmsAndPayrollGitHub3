

---27/1/2021 (EDIT BY MEHUL ) (SP WITH NOLOCK)---
CREATE PROCEDURE [dbo].[GuestUsers]
@Cmp_ID as numeric,
@Domain_Name as varchar(50)
as
SET NOCOUNT ON 
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
SET ARITHABORT ON

	declare @max_id as numeric
	declare @login_id1 as numeric
	declare @login_id2 as numeric
	declare @login_id3 as numeric
	declare @priv_id as numeric

	--Ankit 27032014--
	Declare @Effective_Date As Datetime
	Select @Effective_Date = From_Date From T0010_COMPANY_MASTER WITH (NOLOCK) Where Cmp_Id = @Cmp_ID
	--Ankit 27032014--
	
	select @max_id = ISNULL(MAX(Privilege_ID),0)+1 from T0020_PRIVILEGE_MASTER WITH (NOLOCK)
	
	INSERT INTO T0020_PRIVILEGE_MASTER(Privilege_ID, Cmp_ID, Privilege_Name,Privilege_Type,Branch_Id,Is_Active)
				VALUES(@max_id, @Cmp_ID, 'admin',0,0,1)
	set @max_id = @max_id + 1
	INSERT INTO T0020_PRIVILEGE_MASTER(Privilege_ID, Cmp_ID, Privilege_Name,Privilege_Type,Branch_Id,Is_Active)
				VALUES(@max_id , @Cmp_ID, 'EssUser',1,0,1)				
	
	select @max_id = ISNULL(MAX(Login_id),0)+1 from T0011_LOGIN WITH (NOLOCK)
	INSERT INTO T0011_LOGIN(Login_ID, Cmp_ID, Login_Name, Login_Password,Emp_ID,Branch_ID,Login_Rights_ID,Is_Default,IS_HR,Is_Accou,Email_ID,Email_ID_Accou,Is_Active,Effective_Date)
			 VALUES(@max_id ,@Cmp_ID,'Auditor'+@Domain_Name ,'VuMs/PGYS74=',NULL,NULL,NULL,1,0,0,'','',1,@Effective_Date)
	set @max_id = @max_id + 1
	INSERT INTO T0011_LOGIN(Login_ID, Cmp_ID, Login_Name, Login_Password,Emp_ID,Branch_ID,Login_Rights_ID,Is_Default,IS_HR,Is_Accou,Email_ID,Email_ID_Accou,Is_Active,Effective_Date)
			 VALUES(@max_id ,@Cmp_ID,'Guest1'+@Domain_Name,'VuMs/PGYS74=',NULL,NULL,NULL,1,0,0,'','',1,@Effective_Date)	
	set @max_id = @max_id + 1
	INSERT INTO T0011_LOGIN(Login_ID, Cmp_ID, Login_Name, Login_Password,Emp_ID,Branch_ID,Login_Rights_ID,Is_Default,IS_HR,Is_Accou,Email_ID,Email_ID_Accou,Is_Active,Effective_Date)
			 VALUES(@max_id,@Cmp_ID,'Guest2'+@Domain_Name,'VuMs/PGYS74=',NULL,NULL,NULL,1,0,0,'','',1,@Effective_Date)
	
	select @login_id1 = Login_ID from T0011_LOGIN WITH (NOLOCK) where Login_Name='Auditor'+@Domain_Name
	select @login_id2 = Login_ID from T0011_LOGIN WITH (NOLOCK) where Login_Name='Guest1'+@Domain_Name
	select @login_id3 = Login_ID from T0011_LOGIN WITH (NOLOCK) where Login_Name='Guest2'+@Domain_Name
	select @priv_id = Privilege_ID from T0020_PRIVILEGE_MASTER WITH (NOLOCK) where Privilege_Name='admin' and Cmp_Id=@Cmp_ID

	select @max_id = ISNULL(MAX(Trans_id),0)+1 from T0090_EMP_PRIVILEGE_DETAILS WITH (NOLOCK)

	INSERT INTO T0090_EMP_PRIVILEGE_DETAILS(Trans_Id, Cmp_Id, Login_Id, Privilege_Id,From_Date)
			 VALUES(@max_id ,@CMP_ID,@login_id1,@priv_id, CONVERT(varchar(10),GETDATE(),101))	
set @max_id = @max_id + 1
	INSERT INTO T0090_EMP_PRIVILEGE_DETAILS(Trans_Id, Cmp_Id, Login_Id, Privilege_Id,From_Date)
			 VALUES(@max_id ,@CMP_ID,@login_id2,@priv_id,CONVERT(varchar(10),GETDATE(),101))
set @max_id = @max_id + 1
	INSERT INTO T0090_EMP_PRIVILEGE_DETAILS(Trans_Id, Cmp_Id, Login_Id, Privilege_Id,From_Date)
			 VALUES(@max_id ,@CMP_ID,@login_id3,@priv_id,CONVERT(varchar(10),GETDATE(),101))
	
	----Start -- Manager Priviledge --- Ankit 13042016 ---
	SELECT @max_id = ISNULL(MAX(Privilege_ID),0)+1 from T0020_PRIVILEGE_MASTER WITH (NOLOCK)
	INSERT INTO T0020_PRIVILEGE_MASTER
		(Privilege_ID, Cmp_ID, Privilege_Name,Privilege_Type,Branch_Id,Is_Active)
	VALUES(@max_id, @Cmp_ID, 'Manager',0,0,1)
	
	DECLARE @CurrForm_ID NUMERIC 
	DECLARE CurrPrivi CURSOR FOR
	SELECT Form_ID FROM T0000_DEFAULT_FORM WITH (NOLOCK)
	WHERE Form_ID IN 
		(
		 /* Employee Forms */	6042,6043,6044,6220,6045,6047,6214,6219,6221,6046,6193,6194,6222,6218,6048,6049,6169,6050,6051,6157,6230,6171,6156,6052,6053,6054,6234,
								6055,6249,6056,6167,6127,6166,6252,6228,6148,6138,6139,6140,
		 /* Leave */			6057,6058,6059,6060,6061,6062,6114,6063,6064,6066,6067,6115,6068,6069,6133,6134,6135,6231,6065,6130,6131,6132,6224,6225,6226,6198,6199,6200,6155,
		 /* Loan/Claim/LTA */	6070,6071,6072,6073,6074,6075,6227,6076,6077,6078,6079,6080,6081,6151,6153,6143,6250,6216,6152,6149,6186,6187,6188,6189,6206,6207,6208,
								6209,6210,6211,6212,6213,6215,
		 /* Admin Reports */	6163,6701,6714,6869,6870,6871,6872,6873,6875,6874,6715,6716,6717,6718,6719,6720,6721,6723,6724,6725,6855,6854,6856,6866,6945,6946,6947,6948,
								6949,6966,6702,6726,6727,6728,6729,6730,6731,6732,6733,6734,6735,6736,6737,6933,6944,6967,6968,6969,6703,6738,6739,6740,6741,6742,6743,6744,
								6745,6853,6867,6868,6931,6970,6991,6992,6704,6746,6747,6748,6749,6857,6858,6859,6943,6932,6971,6962,6934,6935,6936,6705,6860,6750,6751,6752,
								6753,6754,6755,6756,6757,6758,6759,6760,6761,6762,6861,6940,6941,6942,6972,6950,6989,6960,6961,6706,6763,6764,6765,6766,6767,6768,6769,6770,
								6771,6772,6773,6774,6775,6776,6777,6778,6779,6780,6707,6781,6782,6783,6784,6785,6786,6787,6939,6788,6789,6790,6959,6708,6791,6792,6793,6794,
								6795,6938,6796,6797,6709,6798,6799,6800,6801,6802,6803,6804,6805,6806,6807,6808,6937,6712,6821,6822,6823,6824,6825,6826,6827,6828,6829,6830,
								6831,6832,6833,6973,6834,6835,6974,6837,6838,6929,6930,6975,6976,6977,6978,6979,6980,6981,6990,6710,6809,6810,6811,6812,6813,6711,6814,6815,
								6816,6817,6818,6819,6820,6839,
		 /* ESS */				7000,7001,7002,7003,7004,7094,7115,7106,7107,7005,7006,7117,7007,7041,7008,7118,7043,7044,7009,7116,7048,7065,7045,7046,7047,7109,7110,7095,
								7010,7011,7084,7012,7013,7076,7077,7078,7119,7014,7108,7015,7087,7088,7089,7120,7092,7093,7052,7057,7059,7058,7060,7019,7020,7021,7022,7053,
								7054,7055,7056,7023,7024,7025,7121,7027,7085,7028,7042,7061,7501,7502,7503,7504,7505,7506,7562,7507,7508,7509,7510,7545,7577,7584,7511,7512,
								7513,7568,7514,7515,7516,7517,7518,7519,7566,7582,7585,7570,7571,7572,7066,7079,7029,7122,7030,7031,7032,7123,7036,7090,7098,7038,7091,7124,
								7033,7111,7034,7035,7125,7099,7096,7097,7062,7521,7522,7523,7524,7561,7525,7526,7527,7528,7546,7576,7583,7588,7578,7529,7530,7531,7569,7532,
								7533,7567,7580,7534,7581,7535,7536,7563,7564,7537,7538,7565,7575,7579,7586,7587,7539,7540,7541,7542,7543,7573,7574,7049,7050,7051,9000,9001,
								9002,9003,9004,9005,9013,9006,9007,9008,9009,9010,9011,9012,9021,9022,9027,9023,9026,9024,9025,9041,9042,9043,9044,9045,9046,9047,9061,9067,
								9064,9068,9065,9069,9070,9081,9082,9083,9084,9085,9086,9101,9102,9103,9121,9131,9132,9133,9134,9135,9136,9137,9138,9151,9152,9153,9154,9158,
								9155,9156,9157,9201,9220,9221,9222,9261,9280,9262,9263,9265,9266,9267,9268,9269,9270,9271,9272,9273,9274,9343,9275,9276,9277,9278,9279,9333,
								9334,9335,9336,9285,9264,9286,9342,9338,9339,9340,9353,9354,9355,9281,9282,9283,9284,9291,9311,9312,9313,9314,9315,9316,9321,9322,9323,9331,
								9332,9324,9325,9326,9327,9328,9329,9337,9330,9344,9345,9346,9347,9348,9349,9350,9351,9352,9356,9357,9358,9359
		)
	OPEN CurrPrivi 
	FETCH NEXT FROM CurrPrivi  INTO @CurrForm_ID
	WHILE @@FETCH_STATUS = 0
		BEGIN
			EXEC P0050_PRIVILEGE_DETAILS @Trans_Id='0',@Privilege_ID=@max_id,@Cmp_ID=@Cmp_ID,@Form_Id=@CurrForm_ID,@Is_View=1,@Is_Edit=1,@Is_Save=1,@Is_Delete=1,@Copy_From_PrivilegeID=0,@tran_type='Insert'
			FETCH NEXT FROM CurrPrivi INTO @CurrForm_ID
		END	
	CLOSE CurrPrivi
	DEALLOCATE CurrPrivi

	
	
	----End  -- Manager Priviledge ------
	
	
return

