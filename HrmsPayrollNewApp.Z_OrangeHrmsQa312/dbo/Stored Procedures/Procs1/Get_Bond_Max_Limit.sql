



CREATE PROCEDURE [dbo].[Get_Bond_Max_Limit]
	@Cmp_ID			numeric,
	@Bond_Id		numeric,
	@Emp_Id			numeric,
	@Bond_Apr_ID	numeric = 0,	
	@For_Date		DateTime = null	
AS
	SET NOCOUNT ON 
	SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	SET ARITHABORT ON 
	
	IF (@Bond_Apr_ID = 0)
		SET @Bond_Apr_ID = NULL
	IF (@For_Date IS NULL)
		SET @For_Date = GETDATE();
		
	DECLARE @EXISTING_BOND_AMT	numeric(18,4)
	DECLARE @BOND_AMOUNT_LIMIT NUMERIC(18,2)
		SET @BOND_AMOUNT_LIMIT = 0
	
	SELECT ISNULL(BOND_AMOUNT,0) AS BOND_MAX_LIMIT  FROM T0040_BOND_MASTER WITH (NOLOCK)  WHERE CMP_ID = @CMP_ID AND BOND_ID = @BOND_ID
			
		
	IF (@BOND_APR_ID IS NOT NULL)
	BEGIN
		SELECT @EXISTING_BOND_AMT = BOND_APR_AMOUNT FROM T0120_BOND_APPROVAL WITH (NOLOCK) WHERE BOND_APR_ID=@BOND_APR_ID		
	END
	IF (@EXISTING_BOND_AMT IS NULL)
			SET @EXISTING_BOND_AMT = 0;
	
	
	 
Return




